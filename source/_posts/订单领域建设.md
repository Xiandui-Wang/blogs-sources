---
title: 订单系统(OFC)架构设计
comment: true
description: 
categories:
- 技术总结
tags:
- 交易履约
---
在供应链领域，OFC系统扮演着承上启下的重要角色。对上承接各各类订单，对下派发生产任务，是履约链路上的核心系统，除此之外，OFC还负责管理生产、履约环节的关键信息，保障上下游系统能及时感知业务变化。

## 技术挑战

面临的挑战与业务特点有关，订单访问QPS100万，峰值提单400万，概括而言就是大流量5000万单、高并发、多业务线
主要的解决手段是流量拆分、业务隔离、读写流量拆分、存储异构

## 架构演进

不同阶段要解决的主要问题时不一样的

| 阶段       | 业务特征             | 系统特征   | 主要挑战           | 解决方案                                                     |
|----------|------------------|--------|----------------|----------------------------------------------------------|
| 订单模块     | 从0快速开始，单量小，业务简单  | 公共系统   | 迭代效率           | 支持快速发布、快速试错，jar包复用彼此功能，公用数据库                             |
| 订单系统     | 单量到10万，业务流程复杂    | 独立系统   | 组织划分变化，代码复杂性上升 | 独立成内聚的服务，独占数据库                                           |
| 订单系统域    | 组织扩展+快速膨胀        | 系统群    | 数据膨胀，读写压力增加    | 读写分离、功能解耦进一步的服务拆分、非骨干链路异步化。可将订单系统拆分为查询、交易、异步处理、统计处理四个子模块 |
| 单元化订单系统域 | 容灾，业务快速扩展，2000万单 | 单元化系统群 | 存储瓶颈、机房瓶颈      | 将数据和服务切分为多个逻辑单元、控制流量的分配、数据互备                             |
| 订单平台     | 降本增效，交易能力复用      ||||


F&Q  

为什么不建议无限制的增加从库数量？ 
- 主库负载增加：在MySQL复制架构中，主库负责生成并发送二进制日志（binlog）给所有从库。当从库数量增加时，主库需要向更多的从库发送相同的二进制日志，这会增加主库的网络I/O负载和CPU负载。尽管发送二进制日志是一个相对轻量级的操作，但当从库数量非常多时，这种负载的累积也可能成为主库的瓶颈。
- 网络带宽和延迟：在分布式环境中，从库可能分布在不同的地理位置，网络带宽和延迟会影响二进制日志的传输效率。从库越多，受网络条件限制的可能性越大，特别是当一些从库位于网络条件较差的地区时，复制延迟的问题会更加明显。
- 从库处理能力：从库需要接收并应用主库发送过来的二进制日志。这个过程涉及到日志的解析和数据的写入操作，会占用从库的CPU和I/O资源。如果从库的硬件资源不足以快速处理这些操作，或者从库上有大量的读取请求竞争资源，也会导致复制延迟。
- 锁竞争：在某些情况下，从库应用二进制日志时可能会遇到锁竞争的问题，尤其是当复制的操作涉及到大量行锁或表锁时。锁竞争会延迟从库应用二进制日志的速度，从而导致复制延迟。
- 复制配置和管理：从库过多也意味着复制架构更加复杂，需要更多的管理和监控工作。不恰当的复制配置或监控不足可能导致复制延迟问题被忽视，或者延迟问题的诊断和解决变得更加困难。
- 总的来说，从库过多可能会从多个方面增加系统的复杂性和负载，导致复制延迟。在设计和部署MySQL复制架构时，需要综合考虑从库的数量、硬件资源、网络条件等因素，以确保复制的高效和稳定。

单元化的设计关键是什么？
- 如何路由流量：建设路由服务，通过用户信息将流量路由到不同的单元
- 如何同步数据
- 如何迁移流量（发生问题时）